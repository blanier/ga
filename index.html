<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>JS BF - </title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script type="text/javascript">

        var worker = new Worker("hello.js");
        worker.addEventListener('message', function(e) {
          if (e.data.type === "generation") {
              displayEntities(e.data.data);
              updateFittest(e.data.data);
          } else if ( e.data.type === "stats" ) {
              displayStats(e.data.data);
          } else {
              console.log(e.data);
          }
        }, false);

        var target = "Hello World"
        var cmd = {cmd: "start", target: target };

        window.onload = function() {
            worker.postMessage(cmd);
        };

        function displayEntities(e) {
            var t = "<table class='generation'><tr><td class='count'>Count</td><td class='fitness'>Fitness</td><td class='outputheader'>Output</td><td class='code'>Code</td></tr>";

            if (e.length > 40) {
                e.length = 40;
            }

            for (i=0; i<e.length; i++) {
                var c = (i%2==0) ? "even_row" : "odd_row";
                t += "<tr class='" + c + "'><td>"+ i +"</td><td>" + roundedDisplay(e[i].fitness) + "</td><td class='output'>" + safeDisplay(e[i].output) + "</td><td>" + e[i].code + "</td></tr>";
            }

            t += "</table>";

            document.getElementById("Generation").innerHTML = t;
        }

        function displayStats(s) {
            document.getElementById("entity_count").innerHTML = s.entity_count;
            document.getElementById("generation_count").innerHTML = s.generation_count;
        }

        function safeDisplay(s) {
            rv = encodeURI(s);
            rv = rv.replace(/%20/g," ");
            if (false && rv.length>20) {
                rv = rv.substring(0,20) + "...";
            }
            return rv;
        }

        function roundedDisplay(f) {
            f = Math.round(f * 1000)/1000;
            return f;
        }

        var fittest = Number.MAX_VALUE;

        function updateFittest(e) {
            if (e[0].fitness < fittest) {
                fittest = e[0].fitness;
                document.title = target + " : " + fittest;
            }

            // stop if we match
            if (false && e[0].output == target) {
                worker.postMessage('cmd');
            }
        }

    </script>
  </head>
  <body>
    <div id="PopulationControl">
    </div>
    <div id="GenerationControl">
      <span class="clickable" id="threadToggle" onclick="worker.postMessage(cmd);"> Stop/Start Thread </span>
      Processed <span id= "entity_count">0</span> entities across <span id= "generation_count">0</span> generations.
    </div>
    <div id="Generation">
      Insert Current Here
    </div>
  </body>
</html>
